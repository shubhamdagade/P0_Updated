<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Air Quality Dashboard | One Lodha Place</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #9e801b;
           --text-greyish: #777777; 
            --glass-bg: rgba(255, 255, 255, 0.35);
            --glass-border: rgba(255, 255, 255, 0.4);
        }
        
        body, html { 
            margin: 0; padding: 0; height: 100vh; width: 100vw;
            font-family: 'Jost', sans-serif;
            background: #1a1a1a url('background.jpg') no-repeat center center fixed; 
            background-size: cover;
            display: flex; flex-direction: column; align-items: center;
            color: var(--text-greyish); overflow: hidden;
        }
 
        /* Video Overlays */
        #video-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: black; z-index: 1000;
        }
        #warning-video, #yt-player { width: 100%; height: 100%; object-fit: cover; border: none; }
 
        /* Admin Panel */
        #admin-panel {
            display: none; position: fixed; bottom: 10vh; background: white; 
            padding: 20px; border-radius: 12px; z-index: 2000; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); width: 340px; text-align: center;
        }
        #admin-panel input { width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        #admin-panel button { padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; margin: 3px; }
 
        /* UI Structure */
        .dashboard-wrapper {
            width: 100vw; height: 100vh; display: flex; flex-direction: column; 
            align-items: center; justify-content: space-between; padding: 6vh 0; box-sizing: border-box;
        }
        .main-headline { font-size: 4vh; font-weight: 400; text-transform: uppercase; text-align: center; letter-spacing: 0.2vw; }
        #status-text { font-weight: 600; }
        .card-container { display: flex; flex-direction: row; gap: 5vw; justify-content: center; align-items: center; width: 100%; flex-grow: 1; }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(25px); border-radius: 2.5vh; width: 50vh; height: 50vh; display: flex; flex-direction: column; justify-content: space-around; align-items: center; border: 0.2vh solid var(--glass-border); }
        .aqi-value { font-size: 15vh; font-weight: 200; color: var(--gold); line-height: 0.7; }
        .footer-text { font-size: 2.5vh; text-transform: uppercase; cursor: pointer; padding: 20px; }
    </style>
</head>
<body>
 
    <div id="video-overlay">
        <video id="warning-video" loop muted playsinline><source id="video-src" src=""></video>
        <div id="yt-player"></div>
    </div>
 
    <div id="admin-panel">
        <h3 style="margin:0; color: #333;">Change Video Source</h3>
        <input type="text" id="new-video-url" placeholder="Paste YouTube, Drive, or MP4 link">
        <div style="display: flex; justify-content: center;">
            <button onclick="saveVideo()" style="background: var(--gold); color: white;">Save</button>
            <button onclick="resetVideo()" style="background: #eee;">Reset to Default</button>
            <button onclick="closeAdmin()" style="background: #333; color: white;">Close</button>
        </div>
    </div>
 
    <div class="dashboard-wrapper" id="main-ui">
        <div class="header-top" style="font-size: 2.5vh;">Live AQI</div>
        <div class="main-headline">Indoor Air Quality is <b id="status-text">...</b></div>
 
        <div class="card-container">
            <div class="glass-card">
                <div style="font-size:3vh"><b>Internal</b> AQI</div>
                <div class="aqi-value" id="in-aqi">--</div>
            </div>
        </div>
 
        <div class="footer-text" ondblclick="toggleAdmin()">One Lodha Place, Mumbai</div>
    </div>
 
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        // 1. CONFIGURATION & DEFAULT LINK
        const DEFAULT_VIDEO = "https://drive.google.com/file/d/1viFP58rFoptqE2oalfbE64E7jgSMATeF/view?usp=sharing";
        
        let ytPlayer, isYouTube = false;
 
        // 2. SMART CONVERTER
        function formatVideoURL(url) {
            if (!url) return "";
            // Handle Google Drive
            if (url.includes('drive.google.com')) {
                const idMatch = url.match(/\/d\/([^/]+)/);
                if (idMatch) return `https://drive.google.com/uc?export=download&id=${idMatch[1]}`;
            }
            return url;
        }
 
        function getYTID(url) {
            const match = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);
            return (match && match[2].length === 11) ? match[2] : null;
        }
 
        // 3. INITIALIZATION
        function onYouTubeIframeAPIReady() {
            const currentLink = localStorage.getItem('customVideo') || DEFAULT_VIDEO;
            const ytID = getYTID(currentLink);
            if (ytID) {
                isYouTube = true;
                ytPlayer = new YT.Player('yt-player', {
                    videoId: ytID,
                    playerVars: { 'autoplay': 1, 'mute': 1, 'controls': 0, 'loop': 1, 'playlist': ytID }
                });
            }
        }
 
        window.onload = function() {
            const currentLink = localStorage.getItem('customVideo') || DEFAULT_VIDEO;
            const formatted = formatVideoURL(currentLink);
            if (!getYTID(currentLink)) {
                document.getElementById('video-src').src = formatted;
                document.getElementById('warning-video').load();
            }
        };
 
        // 4. ADMIN FUNCTIONS
        function toggleAdmin() { document.getElementById('admin-panel').style.display = 'block'; }
        function closeAdmin() { document.getElementById('admin-panel').style.display = 'none'; }
        function saveVideo() {
            const val = document.getElementById('new-video-url').value;
            if (val) { localStorage.setItem('customVideo', val); location.reload(); }
        }
        function resetVideo() { localStorage.removeItem('customVideo'); location.reload(); }
 
        // 5. AQI LOGIC (Simplified for Demo)
        async function updateData() {
            // Placeholder: Replace with your actual Kaiterra/Google fetch logic
            let inAQI = 55; // Set to > 50 to test the video immediately
            
            document.getElementById('in-aqi').innerText = inAQI;
            const vOv = document.getElementById('video-overlay');
            const mUI = document.getElementById('main-ui');
 
            if (inAQI > 50) {
                vOv.style.display = 'block'; mUI.style.display = 'none';
                if (isYouTube && ytPlayer.playVideo) ytPlayer.playVideo();
                else document.getElementById('warning-video').play();
            } else {
                vOv.style.display = 'none'; mUI.style.display = 'flex';
                if (isYouTube && ytPlayer.pauseVideo) ytPlayer.pauseVideo();
                else document.getElementById('warning-video').pause();
            }
        }
        updateData();
    </script>
</body>
</html>
